<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Entity Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
      display: flex;
      justify-content: center;
    }
    .container {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      width: 500px;
    }
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 15px;
      display: flex;
      gap: 10px;
    }
    .form-group label {
      flex: 1;
      margin-bottom: 5px;
      font-weight: bold;
      color: #555;
    }
    .form-group input, .form-group select {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    .checkbox-group {
      margin-left: 10px;
    }
    .checkbox-group input[type="checkbox"] {
      margin-right: 5px;
    }
    .buttons {
      margin-top: 20px;
      text-align: center;
    }
    .buttons button {
      padding: 10px 20px;
      margin-right: 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .buttons .add-field {
      background-color: #007bff;
      color: white;
    }
    .buttons .add-relationship {
      background-color: #6c757d;
      color: white;
    }
    .buttons .add-field:hover, .buttons .add-relationship:hover {
      opacity: 0.9;
    }
    .buttons .generate-entity {
      background-color: #28a745;
      color: white;
    }
    .buttons .generate-entity:hover {
      background-color: #218838;
    }
    .intro {
      text-align: center;
      margin-bottom: 20px;
    }
    .intro a {
      color: #007bff;
      text-decoration: none;
    }
    .intro a:hover {
      text-decoration: underline;
    }
    #fieldsContainer, #relationshipsContainer {
      margin-top: 20px;
    }
    .field-item, .relationship-item {
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
      background-color: #f9f9f9;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Entity Generator</h1>
  <div class="intro">
    <p>Create and manage entities easily. View API docs at <a href="/swagger-ui.html">Swagger UI</a>.</p>
  </div>

  <div class="form-group">
    <label for="entityName">Entity Name</label>
    <input type="text" id="entityName" placeholder="e.g., Product">
  </div>

  <div id="fieldsContainer">
    <div class="field-item">
      <div class="form-group">
        <label for="fieldName0">Field Name</label>
        <input type="text" id="fieldName0" placeholder="e.g., name">
      </div>
      <div class="form-group">
        <label for="fieldType0">Field Type</label>
        <select id="fieldType0">
          <option value="String">String</option>
          <option value="Integer">Integer</option>
          <option value="Long">Long</option>
          <option value="Double">Double</option>
          <option value="Boolean">Boolean</option>
        </select>
      </div>
      <div class="form-group checkbox-group">
        <input type="checkbox" id="notNull0">
        <label for="notNull0">NotNull</label>
      </div>
      <div class="form-group">
        <label for="minSize0">Min Size</label>
        <input type="number" id="minSize0" placeholder="e.g., 1">
      </div>
      <div class="form-group">
        <label for="maxSize0">Max Size</label>
        <input type="number" id="maxSize0" placeholder="e.g., 50">
      </div>
      <div class="form-group">
        <label for="description0">Description</label>
        <input type="text" id="description0" placeholder="e.g., Product name">
      </div>
    </div>
  </div>

  <div id="relationshipsContainer">
    <div class="relationship-item">
      <div class="form-group">
        <label for="relationshipType0">Relationship Type</label>
        <select id="relationshipType0">
          <option value="OneToOne">OneToOne</option>
          <option value="OneToMany">OneToMany</option>
          <option value="ManyToOne">ManyToOne</option>
          <option value="ManyToMany">ManyToMany</option>
        </select>
      </div>
      <div class="form-group">
        <label for="targetEntity0">Target Entity</label>
        <input type="text" id="targetEntity0" placeholder="e.g., Category">
      </div>
      <div class="form-group">
        <label for="sourceField0">Source Field</label>
        <input type="text" id="sourceField0" placeholder="e.g., category">
      </div>
      <div class="form-group">
        <label for="fetchType0">Fetch Type</label>
        <select id="fetchType0">
          <option value="LAZY">LAZY</option>
          <option value="EAGER">EAGER</option>
        </select>
      </div>
    </div>
  </div>

  <div class="buttons">
    <button class="add-field" onclick="addField()">Add Field</button>
    <button class="add-relationship" onclick="addRelationship()">Add Relationship</button>
    <button class="generate-entity" onclick="generateEntity()">Generate Entity</button>
  </div>
</div>

<script>
  let fieldCount = 1;
  let relationshipCount = 1;

  function addField() {
    const container = document.getElementById('fieldsContainer');
    const fieldDiv = document.createElement('div');
    fieldDiv.className = 'field-item';
    fieldDiv.innerHTML = `
                <div class="form-group">
                    <label for="fieldName${fieldCount}">Field Name</label>
                    <input type="text" id="fieldName${fieldCount}" placeholder="e.g., name">
                </div>
                <div class="form-group">
                    <label for="fieldType${fieldCount}">Field Type</label>
                    <select id="fieldType${fieldCount}">
                        <option value="String">String</option>
                        <option value="Integer">Integer</option>
                        <option value="Long">Long</option>
                        <option value="Double">Double</option>
                        <option value="Boolean">Boolean</option>
                    </select>
                </div>
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="notNull${fieldCount}">
                    <label for="notNull${fieldCount}">NotNull</label>
                </div>
                <div class="form-group">
                    <label for="minSize${fieldCount}">Min Size</label>
                    <input type="number" id="minSize${fieldCount}" placeholder="e.g., 1">
                </div>
                <div class="form-group">
                    <label for="maxSize${fieldCount}">Max Size</label>
                    <input type="number" id="maxSize${fieldCount}" placeholder="e.g., 50">
                </div>
                <div class="form-group">
                    <label for="description${fieldCount}">Description</label>
                    <input type="text" id="description${fieldCount}" placeholder="e.g., Product name">
                </div>
            `;
    container.appendChild(fieldDiv);
    fieldCount++;
  }

  function addRelationship() {
    const container = document.getElementById('relationshipsContainer');
    const relDiv = document.createElement('div');
    relDiv.className = 'relationship-item';
    relDiv.innerHTML = `
                <div class="form-group">
                    <label for="relationshipType${relationshipCount}">Relationship Type</label>
                    <select id="relationshipType${relationshipCount}">
                        <option value="OneToOne">OneToOne</option>
                        <option value="OneToMany">OneToMany</option>
                        <option value="ManyToOne">ManyToOne</option>
                        <option value="ManyToMany">ManyToMany</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="targetEntity${relationshipCount}">Target Entity</label>
                    <input type="text" id="targetEntity${relationshipCount}" placeholder="e.g., Category">
                </div>
                <div class="form-group">
                    <label for="sourceField${relationshipCount}">Source Field</label>
                    <input type="text" id="sourceField${relationshipCount}" placeholder="e.g., category">
                </div>
                <div class="form-group">
                    <label for="fetchType${relationshipCount}">Fetch Type</label>
                    <select id="fetchType${relationshipCount}">
                        <option value="LAZY">LAZY</option>
                        <option value="EAGER">EAGER</option>
                    </select>
                </div>
            `;
    container.appendChild(relDiv);
    relationshipCount++;
  }

  function generateEntity() {
    const entityName = document.getElementById('entityName').value;
    const fields = [];
    const relationships = [];

    // Collect fields
    for (let i = 0; i < fieldCount; i++) {
      const fieldName = document.getElementById(`fieldName${i}`)?.value;
      const fieldType = document.getElementById(`fieldType${i}`)?.value;
      const notNull = document.getElementById(`notNull${i}`)?.checked || false;
      const minSize = document.getElementById(`minSize${i}`)?.value || null;
      const maxSize = document.getElementById(`maxSize${i}`)?.value || null;
      const description = document.getElementById(`description${i}`)?.value || null;

      if (fieldName && fieldType) {
        const field = {
          name: fieldName,
          type: fieldType,
          validations: [],
          swaggerConfig: {}
        };

        if (notNull) {
          field.validations.push({ type: "NotNull" });
        }
        if (minSize || maxSize) {
          field.validations.push({
            type: "Size",
            parameters: { min: parseInt(minSize) || 0, max: parseInt(maxSize) || 255 }
          });
        }
        if (description) {
          field.swaggerConfig.description = description;
        }

        fields.push(field);
      }
    }

    // Collect relationships
    for (let i = 0; i < relationshipCount; i++) {
      const relationshipType = document.getElementById(`relationshipType${i}`)?.value;
      const targetEntity = document.getElementById(`targetEntity${i}`)?.value;
      const sourceField = document.getElementById(`sourceField${i}`)?.value;
      const fetchType = document.getElementById(`fetchType${i}`)?.value;

      if (relationshipType && targetEntity && sourceField) {
        relationships.push({
          type: relationshipType,
          targetEntity: targetEntity,
          sourceField: sourceField,
          fetch: fetchType,
          cascade: ["ALL"]
        });
      }
    }

    const metadata = {
      entityName: entityName || "UnnamedEntity",
      packageName: "com.example.generated",
      fields: fields,
      relationships: relationships,
      enableValidation: true,
      enableSwagger: true,
      enableJsonAnnotations: true
    };

    fetch('/api/generator/generate?overwrite=true', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(metadata)
    })
            .then(response => response.json())
            .then(result => {
              alert(result.success ? `Generated: ${result.generatedFiles.join(', ')}` : `Error: ${result.message}`);
            })
            .catch(error => alert(`Error: ${error.message}`));
  }
</script>
</body>
</html>